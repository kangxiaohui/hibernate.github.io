<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="description" content="记录学习生活的点点滴滴" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    Spring框架知识点汇总 |  Mysterious Blog
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  <link rel="shortcut icon" href="/favicon.ico" />
<link rel="stylesheet" href="/css/main.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
<link rel="alternate" href="/atom.xml" title="Mysterious Blog" type="application/atom+xml">
</head>
</html>
<body>
  <div id="app">
    <main class="content">
      <section class="outer">
  <article id="post-Spring框架知识点汇总" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>
  <div class="article-inner">
    <header class="article-header">
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Spring框架知识点汇总
</h1>
    </header>
    <div class="article-meta">
      <a href="/2020/09/03/Spring%E6%A1%86%E6%9E%B6%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/" class="article-date">
  <time datetime="2020-09-03T12:22:38.000Z" itemprop="datePublished">2020-09-03</time>
</a>
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a>
  </div>
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">6.1k字</span>
        </span>
    </span>
    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">27分钟</span>
        </span>
    </span>
</div>
    </div>
    <div class="tocbot"></div>
    <div class="article-entry" itemprop="articleBody">
      <h2 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h2><h3 id="1-简述-IOC-和-DI"><a href="#1-简述-IOC-和-DI" class="headerlink" title="1. 简述 IOC 和 DI"></a>1. 简述 IOC 和 DI</h3><p>IOC（控制反转），是一种设计原则，主要用于解耦组件之间的依赖。由之前的主动请求资源变成被动接受资源。DI（依赖注入）是一种具体的设计模式，体现了 IOC 原则。</p>
<h3 id="2-IOC-的小例子（PPT-上的报表生成服务）"><a href="#2-IOC-的小例子（PPT-上的报表生成服务）" class="headerlink" title="2. IOC 的小例子（PPT 上的报表生成服务）"></a>2. IOC 的小例子（PPT 上的报表生成服务）</h3><h3 id="3-依赖注入的实现"><a href="#3-依赖注入的实现" class="headerlink" title="3. 依赖注入的实现"></a>3. 依赖注入的实现</h3><ul>
<li><p>接口注入</p>
</li>
<li><p>setter 注入</p>
<p>有可能忘记注入，会抛出空指针</p>
<p>代码安全有可能存在问题，依赖会被修改</p>
</li>
<li><p>构造器注入</p>
<p>可避免setter注入的一些缺点</p>
<p>没有含义明确的方法名，对参数位置与数量有要求</p>
</li>
</ul>
<h3 id="4-Spring-框架创始人：Rod-Johnson"><a href="#4-Spring-框架创始人：Rod-Johnson" class="headerlink" title="4. Spring 框架创始人：Rod Johnson"></a>4. Spring 框架创始人：Rod Johnson</h3><p>Spring 框架实现了 IOC 容器，所有的 Bean 对象均由 IOC 容器进行管理和组装</p>
<h3 id="5-配置元数据的方式"><a href="#5-配置元数据的方式" class="headerlink" title="5. 配置元数据的方式"></a>5. 配置元数据的方式</h3><ul>
<li>基于 xml 方式</li>
<li>基注解的配置</li>
<li>基于 Java 的配置</li>
</ul>
<h2 id="第二章-Bean-对象的生命周期"><a href="#第二章-Bean-对象的生命周期" class="headerlink" title="第二章 Bean 对象的生命周期"></a>第二章 Bean 对象的生命周期</h2><h3 id="Spring-IOC-容器概述"><a href="#Spring-IOC-容器概述" class="headerlink" title="Spring IOC 容器概述"></a>Spring IOC 容器概述</h3><p>Spring 容器体现了 IOC（控制反转）原理，Spring 容器通过读取配置元数据负责对 Beans 实例化、配置和装配。常用的配置元数据的方式有 Java 注解、Java 代码方式、xml 方式三种。</p>
<h4 id="1-BeanFactory"><a href="#1-BeanFactory" class="headerlink" title="1. BeanFactory"></a>1. BeanFactory</h4><p>BeanFactory 提供了一个先进的配置机制能够管理任何类型的对象。负责对 Bean 对象的实例化、装配和生命周期的管理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建该工厂需要传入一个 Resource 实例，例如 ClassPathResource 或者 FileSystemResource 等</span></span><br><span class="line">BeanFactory beanFactory = <span class="keyword">new</span> XmlBeanFactory(<span class="keyword">new</span> ClassPathResource(<span class="string">"beans.xml"</span>));</span><br><span class="line"></span><br><span class="line">MyBean bean = (MyBean)factory.getBean(<span class="string">"myBean"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-ApplicationContext-及和-BeanFactory-的区别"><a href="#2-ApplicationContext-及和-BeanFactory-的区别" class="headerlink" title="2. ApplicationContext 及和 BeanFactory 的区别"></a>2. ApplicationContext 及和 BeanFactory 的区别</h4><ul>
<li>ApplicationContext 是 BeanFactory 的一个子接口，同时也是它的一个完整的超集。</li>
<li>BeanFactory 提供了配置框架和基本功能，ApplicationContext 则添加了更多的企业特定功能。</li>
<li>实例Bean的载入方式不同：<ul>
<li>BeanFactory 延迟载入所有 Bean，直到 getBean() 方法调用时才被创建</li>
<li>ApplicationContext 启动后载入所有单实例 Bean。通过预载入单实例 Bean，确保当需要时可以使用</li>
</ul>
</li>
</ul>
<h3 id="Bean-概述"><a href="#Bean-概述" class="headerlink" title="Bean 概述"></a>Bean 概述</h3><h4 id="1-Bean-的实例化方式"><a href="#1-Bean-的实例化方式" class="headerlink" title="1. Bean 的实例化方式"></a>1. Bean 的实例化方式</h4><ul>
<li>通过构造方法实例化</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 最基本的通过构造方法的实例化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"intelCpu"</span> <span class="attr">class</span>=<span class="string">"com.zcx.IntelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"computer"</span> <span class="attr">class</span>=<span class="string">"com.zcx.Computer"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cpu"</span> <span class="attr">ref</span>=<span class="string">"intelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用静态工厂方法实例化</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Cpu cpu;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCpu</span><span class="params">(Cpu cpu)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cpu = cpu;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">		cpu.run();</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Computer <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Computer();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过静态工厂的实例化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"intelCpu"</span> <span class="attr">class</span>=<span class="string">"com.zcx.IntelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"computer"</span> <span class="attr">class</span>=<span class="string">"com.zcx.Computer"</span> <span class="attr">factory-method</span>=<span class="string">"createInstance"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cpu"</span> <span class="attr">ref</span>=<span class="string">"intelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>factory-method 指明工厂方法</p>
</blockquote>
<ul>
<li>使用实例工厂方法实例化</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工厂 Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryBean</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Computer <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Computer();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过实例化工厂实例化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"intelCpu"</span> <span class="attr">class</span>=<span class="string">"com.zcx.IntelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 先配置工厂 bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factoryBean"</span> <span class="attr">class</span>=<span class="string">"com.zcx.FactoryBean"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 直接指定工厂 bean 的  id 和 指定的方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"computer"</span> <span class="attr">factory-bean</span>=<span class="string">"factoryBean"</span> <span class="attr">factory-method</span>=<span class="string">"createInstance"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cpu"</span> <span class="attr">ref</span>=<span class="string">"intelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>factory-bean：指明工厂 Bean</p>
<p>factory-method：指明工厂方法</p>
</blockquote>
<h4 id="2-Bean-的生命周期"><a href="#2-Bean-的生命周期" class="headerlink" title="2. Bean 的生命周期"></a>2. Bean 的生命周期</h4><table>
<thead>
<tr>
<th>步   骤</th>
<th>说   明</th>
</tr>
</thead>
<tbody><tr>
<td>1.实例化</td>
<td>Spring实例化Bean</td>
</tr>
<tr>
<td>2.设置属性</td>
<td>Spring注入Bean的属性</td>
</tr>
<tr>
<td>3.设置Bean名称，Bean工厂，应用上下文</td>
<td>如果Bean实现了XXXAware接口，执行对应方法</td>
</tr>
<tr>
<td>4.预处理(在初始化之前)</td>
<td>调用BeanPostProcessor对象的postProcessBeforeInitialization()方法</td>
</tr>
<tr>
<td>5.初始化Bean</td>
<td>实现InitializingBean接口的afterPropertiesSet()方法   声明了初始化方法，将调用声明的</td>
</tr>
<tr>
<td>6.预处理(在初始化之后)</td>
<td>调用BeanPostProcessor对象的postProcessAfterInitialization()方法【项目中使用过，配置自动初始化字典树的时候】</td>
</tr>
<tr>
<td>7.Bean已经准备好</td>
<td>默认以单例的形式存在Spring容器中</td>
</tr>
<tr>
<td>8.销毁Bean</td>
<td>实现DisposableBean接口的destroy()方法   声明了销毁方法，将调用声明的</td>
</tr>
</tbody></table>
<h4 id="3-实现-Aware-接口"><a href="#3-实现-Aware-接口" class="headerlink" title="3. 实现 *Aware 接口"></a>3. 实现 *Aware 接口</h4><p>在Bean的初始化中使用Spring框架自身的一些对象来执行一些操作</p>
<h4 id="4-Bean-的作用域"><a href="#4-Bean-的作用域" class="headerlink" title="4. Bean 的作用域"></a>4. Bean 的作用域</h4><p><img src="https://gitee.com/LYmystery/PicGo/raw/master/image/20200903153307.png" alt="1598630545613"></p>
<h3 id="Bean-的依赖注入"><a href="#Bean-的依赖注入" class="headerlink" title="Bean 的依赖注入"></a>Bean 的依赖注入</h3><p>主要的注入方式 <strong>setter 方法注入</strong>和构造器注入。</p>
<h4 id="1-构造器注入"><a href="#1-构造器注入" class="headerlink" title="1. 构造器注入"></a>1. 构造器注入</h4><p>通过调用带参数的构造器来实现，每个参数代表着一个依赖关系。构造器参数通过<strong>参数类型</strong>进行匹配。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"intelCpu"</span> <span class="attr">class</span>=<span class="string">"com.zcx.IntelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"computer"</span> <span class="attr">class</span>=<span class="string">"com.zcx.Computer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"intelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们还可以使用type属性指定构造参数的类型</p>
<p>我们还可以使用index属性指定构造参数的索引</p>
<p>我们还可以使用name属性制定构造参数的名字</p>
</blockquote>
<h4 id="2-setter-注入"><a href="#2-setter-注入" class="headerlink" title="2. setter 注入"></a>2. setter 注入</h4><p>在调用了无参构造方法或者无参静态工厂方法实例化bean之后，容器通过回调bean的setter方法可以完成依赖注入。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"intelCpu"</span> <span class="attr">class</span>=<span class="string">"com.zcx.IntelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"computer"</span> <span class="attr">class</span>=<span class="string">"com.zcx.Computer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cpu"</span> <span class="attr">ref</span>=<span class="string">"intelCpu"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>基本数据类型的注入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">value</span>=<span class="string">"xxx"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>空值注入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"xxx"</span>&gt;</span><span class="tag">&lt;<span class="name">null</span> /&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注入引用类数据：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">ref</span>=<span class="string">"xxxBean"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>注入集合类型数据：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// list</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">“xxx”</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">“aa”</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// set</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">“xxx”</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">“aa”</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// map</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">“xxx”</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">“a”</span> <span class="attr">value-ref</span>=<span class="string">“aa”</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="3-高级注入"><a href="#3-高级注入" class="headerlink" title="3. 高级注入"></a>3. 高级注入</h4><p>Spring容器可以自动装配相互协作bean的关联关系。</p>
<p>优点：</p>
<ul>
<li><p>自动装配可以显著得减少指定属性或者构造器参数的需求</p>
</li>
<li><p>当对象发生变化时自动装配可以更新配置而不需要修改配置</p>
</li>
</ul>
<p>缺点：</p>
<ul>
<li><p>Property和constructor-arg显示的依赖设置会覆盖自动装配（故意而为）</p>
</li>
<li><p>自动装配没有显示编写精确</p>
</li>
<li><p>在容器中可能存在多个bean的定义与自动装配的setter方法或者构造方法参数匹配，若bean定义不唯一，装配时会抛异常</p>
</li>
</ul>
<h2 id="第三章-数据验证和-Spring-EL"><a href="#第三章-数据验证和-Spring-EL" class="headerlink" title="第三章 数据验证和 Spring EL"></a>第三章 数据验证和 Spring EL</h2><h3 id="数据验证"><a href="#数据验证" class="headerlink" title="数据验证"></a>数据验证</h3><p>Spring 提供了 validator 接口，有两个方法 supports 和 validate。supports 负责检查该 validator 是否可以校验指定的类，validate 校验给定的对象，如果有校验失败信息，将其放入Errors对象</p>
<h3 id="Spring-EL-简介"><a href="#Spring-EL-简介" class="headerlink" title="Spring EL 简介"></a>Spring EL 简介</h3><p>Spring表达式语言（简称SpEL）是一个支持查询和操作运行时对象导航图功能的强大的表达式语言。最出色的就是函数调用和简单字符串的模板函数。不直接依赖于Spring,可独立使用</p>
<h4 id="1-ExpressionParser"><a href="#1-ExpressionParser" class="headerlink" title="1. ExpressionParser"></a>1. ExpressionParser</h4><p>负责解析表达式字符串</p>
<p><img src="https://gitee.com/LYmystery/PicGo/raw/master/image/20200903153418.png" alt="1598665799438"></p>
<h4 id="2-使用方法"><a href="#2-使用方法" class="headerlink" title="2. 使用方法"></a>2. 使用方法</h4><p>SpEL表达式可以与XML或基于注解的配置元数据使用定义，定义表达式的语法形式：#{&lt;表达式字符串&gt;}</p>
<p>基于 xml 的例子：</p>
<p><img src="https://gitee.com/LYmystery/PicGo/raw/master/image/20200903153228.png" alt></p>
<h4 id="3-高级用法"><a href="#3-高级用法" class="headerlink" title="3. 高级用法"></a>3. 高级用法</h4><ul>
<li><p>调用对象方法</p>
</li>
<li><p>调用对象构造函数</p>
</li>
<li><p>操作符</p>
</li>
<li><p>集合</p>
<blockquote>
<p>.?[] : 设置筛选条件</p>
<p>.^[] : 获取第一个匹配项</p>
<p>.$[] : 获取最后一个匹配项</p>
<p>.![] : 选择特定属性</p>
</blockquote>
</li>
</ul>
<h2 id="第四章-AOP"><a href="#第四章-AOP" class="headerlink" title="第四章 AOP"></a>第四章 AOP</h2><h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>常用的 23 种设计模式之一。使用代理模式创建代理对象，让代理对象控制目标对象的访问，并且可以在不改变目标对象的情况下添加一些额外的功能。分为静态代理和动态代理。</p>
<p>问题：在实现登录注册的同时实现记录日志的功能。</p>
<h4 id="1-静态代理"><a href="#1-静态代理" class="headerlink" title="1. 静态代理"></a>1. 静态代理</h4><p>代理对象与被代理对象必须实现同一个接口，在代理对象中实现日志等服务。调用的时候直接调用代理类相应的方法。</p>
<p>存在的问题：</p>
<ul>
<li>代理对象的一个接口只服务于一种类型的对象</li>
<li>如果要代理的方法很多，要为每种方法进行代理。如果程序较大静态代理不方便。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String userName, String password)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProxy</span> <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> UserService us;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUs</span><span class="params">(UserService us)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.us = us;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"记录日志"</span>);</span><br><span class="line">		us.login(userName, password);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (userName.equals(<span class="string">"zcx"</span>) &amp;&amp; password.equals(<span class="string">"123"</span>)) &#123;</span><br><span class="line">			System.out.println(<span class="string">"success"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"fail"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">UserProxy us = <span class="keyword">new</span> UserProxy();</span><br><span class="line">us.setUs(<span class="keyword">new</span> UserServiceImpl());</span><br><span class="line">us.login(<span class="string">"zcx"</span>, <span class="string">"123"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="2-动态代理"><a href="#2-动态代理" class="headerlink" title="2. 动态代理"></a>2. 动态代理</h4><ul>
<li>实现 InvocationHandler 接口</li>
<li>关键：使用Proxy.newProxyInstance()静态方法建立一个代理对象(建立代理对象必须告知要代理的接口)</li>
<li>操作代理对象时会执行invoke()方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String userName, String password)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handler 类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggerHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Object delegate;</span><br><span class="line">	<span class="comment">// 通过被代理类实例返回代理对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">bind</span><span class="params">(Object delegate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.delegate = delegate;</span><br><span class="line">		<span class="keyword">return</span> Proxy.newProxyInstance(delegate.getClass().getClassLoader(), delegate.getClass().getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行代理类方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"记录日志"</span>);</span><br><span class="line">		method.invoke(delegate, args);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (userName.equals(<span class="string">"zcx"</span>) &amp;&amp; password.equals(<span class="string">"123"</span>)) &#123;</span><br><span class="line">			System.out.println(<span class="string">"success"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"fail"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">LoggerHandler loggerHandler = <span class="keyword">new</span> LoggerHandler();</span><br><span class="line">UserService userService = (UserService)loggerHandler.bind(<span class="keyword">new</span> UserServiceImpl());</span><br><span class="line">userService.login(<span class="string">"zcx"</span>, <span class="string">"123"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="AOP-概述"><a href="#AOP-概述" class="headerlink" title="AOP 概述"></a>AOP 概述</h3><p>AOP(面向切面编程)，提供了一种新的组织程序结构的思路，是对OOP的补充，而不是替代，经常和OOP一起使用，OOP的核心单位是类，而AOP则是切面。可以使开发人员更集中关注系统的核心业务逻辑。提高了代码的复用性和可扩展性。</p>
<h4 id="1-相关概念"><a href="#1-相关概念" class="headerlink" title="1. 相关概念"></a>1. 相关概念</h4><ul>
<li>关注点：一个特定的问题或者程序的功能。例如记录日志</li>
<li>切面：关注点的模块化</li>
<li>连接点：程序执行中的某个点，例如方法等</li>
<li>通知：在特定的连接点应该执行的动作</li>
<li>切入点：定义在哪些连接点使用通知</li>
<li>目标对象：被切面所通知的对象</li>
<li>织入：将切面应用到对象，从而创建新的代理对象的过程。</li>
</ul>
<h4 id="2-通知类型"><a href="#2-通知类型" class="headerlink" title="2. 通知类型"></a>2. 通知类型</h4><ul>
<li>前置通知：Before</li>
<li>后置通知：After</li>
<li>返回通知：AfterReturning</li>
<li>异常通知：AfterThrowing</li>
<li>环绕通知：Around</li>
</ul>
<p>执行顺序：前置、环绕前、环绕后、后置、返回</p>
<h3 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h3><h4 id="1-三种实现方式"><a href="#1-三种实现方式" class="headerlink" title="1. 三种实现方式"></a>1. 三种实现方式</h4><ul>
<li>Spring API</li>
<li>POJO 类</li>
<li>AspectJ 切面</li>
</ul>
<h4 id="2-Spring-API-方式"><a href="#2-Spring-API-方式" class="headerlink" title="2. Spring API 方式"></a>2. Spring API 方式</h4><p>步骤：</p>
<ul>
<li>编写通知</li>
<li>编写切点</li>
<li>Spring 自动创建代理对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不同的通知实现不同的接口</span></span><br><span class="line"><span class="comment">// 以返回通知为例</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnAdvice</span> <span class="keyword">implements</span> <span class="title">AfterReturningAdvice</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* (非 Javadoc)</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Title: afterReturning&lt;/p&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Description: &lt;/p&gt;</span></span><br><span class="line"><span class="comment">	 * @param arg0 方法的返回值类型</span></span><br><span class="line"><span class="comment">	 * @param arg1 扩展的方法</span></span><br><span class="line"><span class="comment">	 * @param arg2 扩展方法参数</span></span><br><span class="line"><span class="comment">	 * @param arg3 扩展对象【目标对象】</span></span><br><span class="line"><span class="comment">	 * @throws Throwable</span></span><br><span class="line"><span class="comment">	 * @see org.springframework.aop.AfterReturningAdvice#afterReturning(java.lang.Object, java.lang.reflect.Method, java.lang.Object[], java.lang.Object)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object arg0, Method arg1, Object[] arg2, Object arg3)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"返回通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String userName, String password)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置代理工厂 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置实体 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"UserServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.zcx.aop.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ReturnAdvice"</span> <span class="attr">class</span>=<span class="string">"com.zcx.advice.ReturnAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置代理工厂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ProxyFactoryBean"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置接口 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"proxyInterfaces"</span> <span class="attr">value</span>=<span class="string">"com.zcx.aop.UserService"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置通知 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BeforeAdvice<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>ReturnAdvice<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AroundAdvice<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置目标对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-POJO-方式-基于-xml"><a href="#3-POJO-方式-基于-xml" class="headerlink" title="3. POJO 方式 - 基于 xml"></a>3. POJO 方式 - 基于 xml</h4><p>优点：</p>
<ul>
<li>不需要实现特定的接口</li>
<li>切面都集中在 xml 文件中，更加集中、清晰</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通知类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdvice</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 两个参数，第二个表示返回值类型</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"返回通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"后置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 注意存在返回值</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知前"</span>);</span><br><span class="line">		<span class="comment">// 获得切点的参数</span></span><br><span class="line">		Object[] args = joinPoint.getArgs();</span><br><span class="line">		Object result = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 调用原方法</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			result = joinPoint.proceed();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知后"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 注意参数名称</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">thorwException</span><span class="params">(Exception ex)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"异常通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置业务逻辑 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"UserServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.zcx.aop.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"MyAdvice"</span> <span class="attr">class</span>=<span class="string">"com.zcx.advice.MyAdvice"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- aop 方式配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"MyAspect"</span> <span class="attr">ref</span>=<span class="string">"MyAdvice"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.zcx.aop.*.* (..))"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注意 returning 属性必须和通知方法中的第二个参数的名字一样 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturning"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.zcx.aop.*.* (..))"</span> <span class="attr">returning</span>=<span class="string">"result"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"after"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.zcx.aop.*.* (..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"around"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.zcx.aop.*.* (..))"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- throwing 属性也必须和通知方法中的参数的名字一样  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"thorwException"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.zcx.aop.*.*(..))"</span> <span class="attr">throwing</span>=<span class="string">"ex"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-POJO-方式-基于注解"><a href="#4-POJO-方式-基于注解" class="headerlink" title="4. POJO 方式 - 基于注解"></a>4. POJO 方式 - 基于注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdvice</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Before</span>(<span class="string">"execution(* com.zcx.aop.*.* (..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 两个参数，第二个表示返回值类型</span></span><br><span class="line">	<span class="meta">@AfterReturning</span>(pointcut=<span class="string">"execution(* com.zcx.aop.*.* (..))"</span>,returning=<span class="string">"result"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"返回通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@After</span>(<span class="string">"execution(* com.zcx.aop.*.* (..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"后置通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 注意存在返回值</span></span><br><span class="line">	<span class="meta">@Around</span>(<span class="string">"execution(* com.zcx.aop.*.* (..))"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知前"</span>);</span><br><span class="line">		<span class="comment">// 获得切点的参数</span></span><br><span class="line">		Object[] args = joinPoint.getArgs();</span><br><span class="line">		Object result = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">// 调用原方法</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			result = joinPoint.proceed();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"环绕通知后"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@AfterThrowing</span>(pointcut=<span class="string">"execution(* com.zcx.aop.*.*(..))"</span>,throwing=<span class="string">"ex"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">thorwException</span><span class="params">(Exception ex)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"异常通知"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启 xml 配置方式  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注解扫描 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在指定的 package下扫描以及注册 javabean 【具备 &lt;context:annotation-config /&gt; 的功能】 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.zcx"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="第五章-Spring-MVC"><a href="#第五章-Spring-MVC" class="headerlink" title="第五章 Spring MVC"></a>第五章 Spring MVC</h2><h3 id="1-Spring-MVC-概述"><a href="#1-Spring-MVC-概述" class="headerlink" title="1. Spring MVC 概述"></a>1. Spring MVC 概述</h3><h4 id="1-1-Spring-MVC-简介"><a href="#1-1-Spring-MVC-简介" class="headerlink" title="1.1 Spring MVC 简介"></a>1.1 Spring MVC 简介</h4><p>是一个基于请求驱动的，围绕一个核心Servlet转发请求到对应的Controller而设计的。</p>
<p>优点：</p>
<ul>
<li>典型的 MVC 框架，易学易用</li>
<li>清晰的角色划分</li>
<li>可重用的业务代码</li>
<li>可定制的数据绑定和验证，可定制的视图解决方案</li>
<li>提供了一套强大又使用简单的标签库</li>
</ul>
<h4 id="1-2-Spring-MVC-体系结构"><a href="#1-2-Spring-MVC-体系结构" class="headerlink" title="1.2 Spring MVC 体系结构"></a>1.2 Spring MVC 体系结构</h4><p>1、客户端发出请求，交给DispatcherServlet处理</p>
<p>2、DispatcherServlet根据请求信息及HandlerMapping的配置找到处理请求的处理器（Handler）</p>
<p>3、DispatcherServlet通过HandlerAdapter对Handler进行封装，再以统一的适配器接口调用Handler</p>
<p>4、处理器完成业务逻辑，返回一个ModelAndVIew给DispatcherServlet，ModelAndView包含视图逻辑名和模型数据信息</p>
<p>5、DispatcherServlet借由ViewResolver完成逻辑视图名到真实视图的解析工作</p>
<p>6、得到View真实视图后，DispatcherServlet就使用这个View对象对ModelAndView中的模型数据进行渲染</p>
<p>7、最终客户得到响应</p>
<p><img src="https://gitee.com/LYmystery/PicGo/raw/master/image/20200903153104.png" alt="1598755721322"></p>
<h3 id="2-控制器"><a href="#2-控制器" class="headerlink" title="2. 控制器"></a>2. 控制器</h3><h4 id="2-1-DispatcherServlet"><a href="#2-1-DispatcherServlet" class="headerlink" title="2.1 DispatcherServlet"></a>2.1 DispatcherServlet</h4><p>DispatcherServlet继承自HttpServlet，是整个SpringMVC中的前端控制器，主要负责流程控制。</p>
<h4 id="2-2-在-DispatcherServlet-中的执行过程"><a href="#2-2-在-DispatcherServlet-中的执行过程" class="headerlink" title="2.2 在 DispatcherServlet 中的执行过程"></a>2.2 在 DispatcherServlet 中的执行过程</h4><ul>
<li><p>寻找 WebApplicationContext，并将 WebApplicationContext作为一个属性绑定到请求里，以便控制器或其他原件在后续中使用。</p>
</li>
<li><p>将本地化解析器绑定到请求里，以便在处理这个请求时，原件可以解析到客户端的地区（为了渲染视图，准备日期等）</p>
</li>
<li><p>将主题解析其绑定到请求里，让原件（如视图）决定去使用哪一种主题</p>
</li>
<li><p>若指定一个multipart file解析器，会检查这个请求包含multiparts请求</p>
</li>
<li><p>寻找合适的 handler。如何找到这个 handler，执行与这个 handler 关联的执行链</p>
</li>
<li><p>如果返回一个 model，渲染相对应的视图</p>
</li>
</ul>
<h4 id="2-3-配置-DispatcherServlet"><a href="#2-3-配置-DispatcherServlet" class="headerlink" title="2.3 配置 DispatcherServlet"></a>2.3 配置 DispatcherServlet</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml 中配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置上下文参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">        classpath*:/applicationContext.xml</span><br><span class="line">    <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 一个监听器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- DispatcherServlet 配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-4-Controller-控制器类"><a href="#2-4-Controller-控制器类" class="headerlink" title="2.4 Controller 控制器类"></a>2.4 Controller 控制器类</h4><p><strong>@Controller</strong></p>
<p><strong>@RequestMapping</strong></p>
<ul>
<li>各种参数绑定方法</li>
</ul>
<p><strong>@RequestParam</strong></p>
<ul>
<li>请求参数绑定到方法</li>
</ul>
<p><strong>@ResponseBody</strong></p>
<ul>
<li>此注解用在方法上，用来表示直接将返回数据写到HTTP响应体里</li>
</ul>
<p>@PathVariable</p>
<ul>
<li>参数绑定在路径中</li>
</ul>
<p>@MatrixVariable</p>
<ul>
<li>矩阵变量</li>
</ul>
<p>@CookieValue</p>
<ul>
<li>注解允许将方法参数与HTTPcookie 值绑定</li>
</ul>
<p>@RequestHeader </p>
<ul>
<li>映射请求头字段属性</li>
</ul>
<h3 id="3-拦截器"><a href="#3-拦截器" class="headerlink" title="3. 拦截器"></a>3. 拦截器</h3><h4 id="3-1-拦截器使用"><a href="#3-1-拦截器使用" class="headerlink" title="3.1 拦截器使用"></a>3.1 拦截器使用</h4><pre><code>/*
* 拦截器的使用
* 一、创建实现了 HandlerInterceptor 接口的 Java 类，实现相应的方法
*     preHandle：执行访问资源之前执行的方法，该方法的返回值为 Boolean 类型，如果返回值为 true，表示放行
*             接着执行后边的单元方法，如果返回值为 false，拦截，不继续执行
*     postHandle：第二个要执行的方法
*     afterCompletion：第三个最后要执的方法
* 
* 二、在 springmvc.xml 文件中配置拦截器
    &lt;mvc:interceptors&gt;
        &lt;!-- 配置全局的拦截器 ,拦截所有的单元方法--&gt;
        &lt;!-- &lt;bean id=&quot;myq&quot; class=&quot;com.zcx.interceptor.MyInterceptor&quot;&gt;&lt;/bean&gt;  --&gt;
        &lt;!-- 配置指定的拦截器，拦截指定的单元方法 --&gt;
        &lt;mvc:interceptor&gt;
            &lt;mvc:mapping path=&quot;/demo&quot;/&gt;
            &lt;bean id=&quot;myj&quot; class=&quot;com.zcx.interceptor.MyInterceptor&quot;&gt;&lt;/bean&gt;
        &lt;/mvc:interceptor&gt;        
    &lt;/mvc:interceptors&gt;
* 三、使用单拦截器时的执行顺序
*     DispatcherServlet --&gt;拦截器 ---&gt; preHandle ---&gt; 单元方法 ---&gt; 拦截器 ---&gt; postHandle ---&gt; afterCompletion
* 四、支持多重的拦截器：
*     配置在前边的拦截器为外层拦截器，配置在后边的拦截器为内层拦截器，执行顺序为：
*         外层 preHandle，内层的 preHandle，
*         单元方法
*         内层的 postHandle，外层的 postHandle
*         内层的 afterCompletion，外层的 afterCompletion
*/</code></pre><h4 id="3-2-实现"><a href="#3-2-实现" class="headerlink" title="3.2 实现"></a>3.2 实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line">	<span class="comment">//依赖注入</span></span><br><span class="line">	<span class="meta">@Resource</span></span><br><span class="line">	<span class="keyword">private</span> MyCon myCon;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"3-----"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * request：请求对象</span></span><br><span class="line"><span class="comment">	 * response：响应对象</span></span><br><span class="line"><span class="comment">	 * handler：HandlerMethod 对象，封装了要请求的单元方法对象以实现在 preHandle 方法中可以调用一次单元方法，</span></span><br><span class="line"><span class="comment">	 * modelAndView：单元方法的返回值对象，可以根据需要重新设置返回值的内容，跳到指定的 jsp 页面</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="function"><span class="params">			ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//		modelAndView.setViewName("forward:/jsp/error.jsp");</span></span><br><span class="line"><span class="comment">//		System.out.println(modelAndView.getViewName());</span></span><br><span class="line">		System.out.println(<span class="string">"2-----"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * request：请求对象</span></span><br><span class="line"><span class="comment">	 * response：响应对象</span></span><br><span class="line"><span class="comment">	 * handler：HandlerMethod 对象，封装了要请求的单元方法对象以实现在 preHandle 方法中可以调用一次单元方法，</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//		HandlerMethod hm = (HandlerMethod)handler;</span></span><br><span class="line"><span class="comment">//		hm.getMethod().invoke(myCon, "zs", "123");</span></span><br><span class="line">		System.out.println(<span class="string">"1-----"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-文件上传"><a href="#4-文件上传" class="headerlink" title="4. 文件上传"></a>4. 文件上传</h3><h4 id="4-1-两种实现方式"><a href="#4-1-两种实现方式" class="headerlink" title="4.1 两种实现方式"></a>4.1 两种实现方式</h4><ul>
<li>基于 Servlet3.0</li>
<li>基于Commons FileUpload</li>
</ul>
<h4 id="4-2-文件上传实现"><a href="#4-2-文件上传实现" class="headerlink" title="4.2 文件上传实现"></a>4.2 文件上传实现</h4><p>springmvc.xml 配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置文件上传解析 bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置编码 解析格式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置上传数据的总大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInMemorySize"</span> <span class="attr">value</span>=<span class="string">"104857600"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置单个文件的大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"10485760"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"upload"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">myUpload</span><span class="params">(String username, String password, MultipartFile photo, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取后缀名</span></span><br><span class="line">    String suffixName = photo.getOriginalFilename().substring(photo.getOriginalFilename().lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    <span class="comment">//动态生成文件名</span></span><br><span class="line">    String fileName = <span class="string">""</span> + UUID.randomUUID() + System.currentTimeMillis();</span><br><span class="line">    <span class="comment">//拼接文件名</span></span><br><span class="line">    String newName = fileName + suffixName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置文件存储目录</span></span><br><span class="line">    String path = request.getServletContext().getRealPath(<span class="string">"/images"</span>);</span><br><span class="line">    File fpath = <span class="keyword">new</span> File(path);</span><br><span class="line">    <span class="keyword">if</span>(!fpath.exists()) &#123;</span><br><span class="line">        <span class="comment">//如果目录不存在，则创建</span></span><br><span class="line">        fpath.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过目录加文件名存储文件</span></span><br><span class="line">    File file = <span class="keyword">new</span> File(fpath, newName);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//将文件存储到服务器</span></span><br><span class="line">        photo.transferTo(file);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用原始的数据库操作，将数据信息保存到数据库中，后期可以改为 Mybatis</span></span><br><span class="line">    upLoadFileService.uploadFile(<span class="number">1</span>, photo.getOriginalFilename(), newName, photo.getContentType());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"forward:/success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-视图解析"><a href="#5-视图解析" class="headerlink" title="5. 视图解析"></a>5. 视图解析</h3><h4 id="5-1-ViewResolver-和-View"><a href="#5-1-ViewResolver-和-View" class="headerlink" title="5.1 ViewResolver 和 View"></a>5.1 ViewResolver 和 View</h4><ul>
<li><p>ViewResolver提供了视图名称和真实视图之间的映射</p>
</li>
<li><p>View 是真正进行视图渲染，把结果返回给浏览器的</p>
</li>
</ul>
<h4 id="5-2-配置视图解析器"><a href="#5-2-配置视图解析器" class="headerlink" title="5.2 配置视图解析器"></a>5.2 配置视图解析器</h4><p>InternalResourceViewResolver</p>
<ul>
<li><p>它是URLBasedViewResolver的子类</p>
</li>
<li><p>它定义了前缀、后缀，并和控制器返回的视图名称拼接在一起，并解析为视图对象</p>
</li>
<li><p>它会将模型数据存放到对应的HttpServletRequest中，然后转发到相应的页面视图</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"resourceViewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="第六章-Spring-For-JDBC-And-Transaction"><a href="#第六章-Spring-For-JDBC-And-Transaction" class="headerlink" title="第六章 Spring For JDBC And Transaction"></a>第六章 Spring For JDBC And Transaction</h2><h3 id="1-Spring-For-JDBC"><a href="#1-Spring-For-JDBC" class="headerlink" title="1. Spring For JDBC"></a>1. Spring For JDBC</h3><h4 id="1-1-Repository-注解"><a href="#1-1-Repository-注解" class="headerlink" title="1.1 @Repository 注解"></a>1.1 @Repository 注解</h4><p>用来定义一个持久化类（xxxDao.java）</p>
<h4 id="1-2-定义数据源"><a href="#1-2-定义数据源" class="headerlink" title="1.2 定义数据源"></a>1.2 定义数据源</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-3-JdbcTemplate-类"><a href="#1-3-JdbcTemplate-类" class="headerlink" title="1.3 JdbcTemplate 类"></a>1.3 JdbcTemplate 类</h4><p>Spring 对 JDBC 支持类库中的核心类。负责创建和释放资源，执行SQL语句、存储过程，并通过ResultSet来返回数据。</p>
<p>配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>简单的使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增加，修改和删除一样</span></span><br><span class="line"><span class="keyword">this</span>.jdbcTemplate.update(<span class="string">"insert into student(id, name) values(?, ?)"</span>, <span class="keyword">null</span>, student.getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回自增主键</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">addStudentAndReturnKey</span><span class="params">(<span class="keyword">final</span> Student student)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">"insert into student(name) values(?)"</span>;</span><br><span class="line"></span><br><span class="line">    KeyHolder keyHolder = <span class="keyword">new</span> GeneratedKeyHolder();</span><br><span class="line">    jdbcTemplate.update(<span class="keyword">new</span> PreparedStatementCreator() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> PreparedStatement <span class="title">createPreparedStatement</span><span class="params">(Connection con)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">            PreparedStatement pstm = con.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">            pstm.setString(<span class="number">1</span>, student.getName());</span><br><span class="line">            <span class="keyword">return</span> pstm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, keyHolder);</span><br><span class="line">    <span class="keyword">return</span> keyHolder.getKey().intValue();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 批量插入</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addStudentList</span><span class="params">(List&lt;Student&gt; students)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">"insert into student(name) values(?)"</span>;</span><br><span class="line"></span><br><span class="line">    jdbcTemplate.batchUpdate(sql, <span class="keyword">new</span> BatchPreparedStatementSetter() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValues</span><span class="params">(PreparedStatement pstm, <span class="keyword">int</span> index)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">            pstm.setString(<span class="number">1</span>, students.get(index).getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBatchSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> students.size();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询</span></span><br><span class="line"><span class="comment">// sql 语句 | 参数列表 | 返回值类型</span></span><br><span class="line">String name = jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> Object[] &#123;id&#125;, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 RowMapper 查询单个对象</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">queryStudentByRowMapper</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">"select * from student where id = ?"</span>;</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> Object[] &#123;id&#125;, <span class="keyword">new</span> RowMapper&lt;Student&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">            Student stu = <span class="keyword">new</span> Student();</span><br><span class="line">            stu.setName(rs.getNString(<span class="string">"name"</span>));</span><br><span class="line">            <span class="keyword">return</span> stu;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 RowMapper 查询所有对象</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">queryAllStudentByRowMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">"select * from student"</span>;</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.query(sql, <span class="keyword">new</span> RowMapper&lt;Student&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">            Student stu = <span class="keyword">new</span> Student();</span><br><span class="line">            stu.setName(rs.getNString(<span class="string">"name"</span>));</span><br><span class="line">            <span class="keyword">return</span> stu;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>注意简单的增删改均是使用 update 方法</li>
<li>使用 keyHolder 返回自增主键</li>
<li>查询单个对象 queryForObject，查询所有对象 query</li>
</ul>
</blockquote>
<h3 id="2-对事务的支持"><a href="#2-对事务的支持" class="headerlink" title="2. 对事务的支持"></a>2. 对事务的支持</h3><h4 id="2-1-对事物的描述"><a href="#2-1-对事物的描述" class="headerlink" title="2.1 对事物的描述"></a>2.1 对事物的描述</h4><p>原子性、一致性、隔离性、持久性</p>
<h4 id="2-2-声明式事务和编程式事务"><a href="#2-2-声明式事务和编程式事务" class="headerlink" title="2.2 声明式事务和编程式事务"></a>2.2 声明式事务和编程式事务</h4><p>编程式事务管理：</p>
<ul>
<li><p>可以清楚地控制事务的边界</p>
</li>
<li><p>可自行实现事务开始时间、结束时间、撤消操作的时机等</p>
</li>
<li><p>可以实现细粒度的事务控制</p>
</li>
</ul>
<p>声明式事务管理：</p>
<ul>
<li><p>好处是事务管理的API不介入程序，最符合一个非侵入型轻量级容器的理想</p>
</li>
<li><p>多数情况下事务不需要细粒度控制，因此建议使用</p>
</li>
</ul>
<h4 id="2-3-声明式事务"><a href="#2-3-声明式事务" class="headerlink" title="2.3 声明式事务"></a>2.3 声明式事务</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用annotation定义事务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在 applicationContext.xml 中进行如上配置之后，直接使用 @Transactional 进行配置</p>
</blockquote>
<h2 id="第七章-对象关系映射"><a href="#第七章-对象关系映射" class="headerlink" title="第七章 对象关系映射"></a>第七章 对象关系映射</h2><h3 id="1-Spring-集成-Hibernate"><a href="#1-Spring-集成-Hibernate" class="headerlink" title="1. Spring 集成 Hibernate"></a>1. Spring 集成 Hibernate</h3><p>步骤：</p>
<ul>
<li>配置数据源 DataSource</li>
<li>配置 SessionFactory</li>
<li>编写实体 Bean、实现 Dao 类</li>
<li>添加事务</li>
<li>实现 Service、Controller</li>
</ul>
<p>各层对象注入顺序：</p>
<p>DataSource —&gt; SessionFactory —&gt; Dao —&gt; Service —&gt; Controller</p>
      <!-- reward -->
      <div id="reward-btn">
        打赏
      </div>
    </div>
      <!-- copyright -->
        <div class="declare">
          <ul class="post-copyright">
            <li>
              <i class="ri-copyright-line"></i>
              <strong>版权声明： </strong s>
              本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" rel="external nofollow"
                target="_blank">Apache License 2.0</a> 许可协议。转载请注明出处！
            </li>
          </ul>
        </div>
    <footer class="article-footer">
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>
<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://www.kangxh.xyz/2020/09/03/Spring%E6%A1%86%E6%9E%B6%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/" alt="微信分享二维码">
    </div>
</div>
<div id="share-mask"></div>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul>
    </footer>
  </div>
  <nav class="article-nav">
      <a href="/2020/09/03/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">项目管理知识点汇总</div>
      </a>
  </nav>
<!-- valine评论 -->
<div id="vcomments-box">
    <div id="vcomments">
    </div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'YwmXvjupK5viD3J1zt9Wi2w8-gzGzoHsz',
        app_key: 'RjopPMnE4JaX1cUINrVB6m1V',
        path: window.location.pathname,
        notify: 'false',
        verify: 'false',
        avatar: 'mp',
        placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
        recordIP: true
    });
    const infoEle = document.querySelector('#vcomments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
        infoEle.childNodes.forEach(function (item) {
            item.parentNode.removeChild(item);
        });
    }
</script>
<style>
    #vcomments-box {
        padding: 5px 30px;
    }
    @media screen and (max-width: 800px) {
        #vcomments-box {
            padding: 5px 0px;
        }
    }
    #vcomments-box #vcomments {
        background-color: #fff;
    }
    .v .vlist .vcard .vh {
        padding-right: 20px;
    }
    .v .vlist .vcard {
        padding-left: 10px;
    }
</style>
</article>
</section>
      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2019-2020
        Mystery
      </li>
      <li>
        Powered by
        Hexo Theme Ayer
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
      </li>
      <li>
        <!-- cnzz统计 -->
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
      </li>
    </ul>
  </div>
</footer>
      <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    <aside class="sidebar">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Mysterious Blog"></a>
  </div>
  <ul class="nav nav-main">
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>
<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
  </div>
</div>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/share.js"></script>
<script src="/js/lazyload.min.js"></script>
<script>
  try {
    var typed = new Typed("#subtitle", {
      strings: ['尚未佩妥剑，转眼便江湖。愿历尽千帆，归来仍少年', '白茶清欢无别事，我在等风也等你', '感谢相遇，不计得失'],
      startDelay: 0,
      typeSpeed: 200,
      loop: true,
      backSpeed: 100,
      showCursor: true
    });
  } catch (err) {
  }
</script>
<script src="/js/tocbot.min.js"></script>
<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    onClick: (e) => {
      $('.toc-link').removeClass('is-active-link');
      $(`a[href=${e.target.hash}]`).addClass('is-active-link');
      $(e.target.hash).scrollIntoView();
      return false;
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/ayer.js"></script>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))
        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>
<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>
    <div id="music">
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=31134623&auto=0&height=32"></iframe>
</div>
<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
  </div>
</body>
</html>